{% extends 'base.html' %} <!-- bootstrap -->

{%block head_title %} 
This is amazing!!!!!!!!!
{% endblock head_title %}


{% block content %} <!-- bootstrap -->
<div class='row text-center'>
    <div class="col">
        <h1>Welcome to Tweetme</h1>
    </div>

</div>

<div class="row mb-3">
    <div class="col-md-4 mx-auto col-10">
        <form class="form" method="POST" action="/create-tweet">
            {% csrf_token %}
            <input type="hidden" value="/" name="next">
            <textarea class="form-control" name="content" placeholder="Your tweet..."></textarea>
            <button type='submit' class="btn btn-primary">Tweet</button>
        </form>
    </div>

</div>


<div class='row' id="tweets">
<!-- replace w JS-->
   Loading....
</div>


<script>

    // Replace with JS
    const tweetsElement = document.getElementById('tweets')
    // tweetsElement.innerHTML = 'Loading...'

    //List View
const xhr = new XMLHttpRequest()
const method = 'GET'
const url = '/tweets'
const responseType = 'json'

//Handle like
function handleDidLike(tweet_id, currentCount){
    console.log(tweet_id, currentCount)
}

//Create Like Button
function likeBtn(tweet){
    return "<button class='btn btn-primary btn-sm' onclick=handleDidLike(" + tweet.id +
     "," + tweet.likes+ ")>"+tweet.likes+" Likes</button>"
}


//Format string function
function formatTweetElement(tweet){
   var formattedTweet =  '<div class="col-12 col-md-10 mx-auto border rounded py-3 mb-4 tweet" id="tweet-'+ tweet.id +'"">' 
            + '<p>' + tweet.content +
                
                "</p><div class='btn-group'>" + likeBtn(tweet) +
                
                '</div></div>'

    return formattedTweet
}


//Lets xhr request know it's getting json back
xhr.responseType = responseType 

xhr.open(method,url)
//What gets created when the function triggers
xhr.onload = function (){
    //console.log(xhr.response)
    const serverResponse = xhr.response
    var listedItems = serverResponse.response //array
    var finalTweetStr = ""
    var i
    // finalTweetStr +='<ul>'
    for(i=0; i< listedItems.length; i++){
        // console.log(listedItems[i].content)
        // finalTweetStr += '<li>' + listedItems[i].content + '</li>'
        // finalTweetStr += '<div class="mb-4"><h1>' 
        //     + listedItems[i].id + '</h1><p>' + listedItems[i].content + '</p></div>'
        finalTweetStr += formatTweetElement(listedItems[i])
    } 

    // finalTweetStr += '</ul>'
    //finalTweetStr.append(listedItems[i].content)
    // console.log(listedItems)
    // console.log(finalTweetStr + " the list")

    tweetsElement.innerHTML = finalTweetStr

}
//triggers the request
xhr.send()

</script>
{% endblock content %}